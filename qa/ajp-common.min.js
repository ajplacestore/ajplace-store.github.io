(function() {
    try {

        let Common = {
            init: () => {
                Common.applyConfigInSearchField();
                //Common.returnPreviousPage();
                Common.mobileSearchFieldToggle();
                Common.headerConfig();
            },
            ajaxStop: () => {
                Common.fixShelfValue();
            },
            mobileSearchFieldToggle: () => {
                let search = $('.header__link--search');
                let close = $('.search__close');
                let field = $('.header__search-field');
                //close.removeClass('hide');

                // Open Field
                search.on('click', e => {
                    e.preventDefault();
                    
                    $(".search__form").slideDown("fast");
                    $(".search__target").empty();

                    if ($(window).width() < 992) {
                        search.hide("fast");
                        close.show("fast");
                    }
                });

                // Close Field
                close.on('click', e => {
                    e.preventDefault();

                    $(".search__form").slideUp("fast");
                    $(".search__target").empty();

                    if ($(window).width() < 992) {
                        close.hide("fast");
                        search.show("fast");
                    }
                });
 

            },
            applyConfigInSearchField: () => {
                let input = $(".search__input");
                input.on('click', function () {
                    $(this).val(' ');
                });
                $(document).click(function(event) {
                    if (!$(event.target).is(".search__input")) {
                        input.val('');
                        // let thisInput = $('.search__input')[0];
                        // thisInput.placeholder = "O QUE VOCÊ DESEJA ENCONTRAR?"; 
                    }
                });
            },
            returnPreviousPage: () => {
                if (localStorage.AJP_prevUrl && localStorage.AJP_prevUrl.length) {
                    $("#return-to-prev-page").attr('href', localStorage.getItem("AJP_prevUrl"));
                    localStorage.setItem("AJP_currentUrl", window.location.href);

                    // Antes de trocar de página seto a pagina atual como anterior na proxima
                    $(window).unload(function() {
                        localStorage.setItem("AJP_prevUrl", window.location.href);
                    });
                } else {
                    console.log('[ELSE]');
                    window.localStorage.setItem("AJP_prevUrl", window.location.href);
                    window.localStorage.setItem("AJP_currentUrl", window.location.href);
                }

                // $(window).on("hashchange", function(e) {
                //     console.log('aquiii')
                //     console.log(window.location.href);
                // })
            },
            fixShelfValue: () => {
                //$(document).ajaxStop(function () {});
                $(".shelf-item").each((index, element) => {
                    const _this = $(element);
                    if (_this.find(".shelf-item__installments").children().length <= 0) {
                        _this.find(".shelf-item__installments").addClass("withoutInstallment");
                        _this.find(".shelf-item__best-price").addClass("withoutInstallment");
                    }
                });
            },
            headerConfig: () => {
                console.log("[headerConfig]");
                let wrapper = $(".ajp-header__menu--list");
                $(".main-links").on("mouseenter", function() {
                    let $t = $(this);
                    console.log("Entter")
                });


                // $("#ajp-button-user").on("click", function () {
                //     $(".infos-block").toggle();
                // })
            }
        }

        // Instanciando a funcao
        $(document).ready(Common.init)
        $(document).ajaxStop(Common.ajaxStop);

    } catch (e) {
        console.log("Erro na instância do [Common]: ", e);
    }

})();