/*Dev - Orion Ecommerce - almeidajunior @date Mon May 31 2021 18:04:21 GMT-0300 (GMT-03:00) */

"use strict";!function(){try{var o={init:function(){o.getInfo(),$(document.body).is(".product")&&(o.addProdutcInList(),o.removeProductInList()),o.addShelfProductInList(),o.removeShelfProductInList()},dataUserOrderForm:null,dataUserParsed:null,getInfo:function(){var e;localStorage&&localStorage.AJP_listUser&&localStorage.AJP_listUser.length?(e=JSON.parse(localStorage.AJP_listUser),null==(o.dataUserParsed=e).userItems?o.emptyListInUserPage():e.userItems.length&&($(document.body).is(".product")&&o.setDataInFrontProduct(),$(document.body).is(".wishlist")&&o.showProductsInFavorites(),o.showProductInShowAlreadyAdd(),$(".shelf-item__wishlist button").removeClass("list-loaded"))):vtexjs.checkout.getOrderForm().done(function(e){e.clientProfileData&&null!=e.clientProfileData.email?o.getInfoByOrderForm(e):$(".shelf-item__wishlist button").removeClass("list-loaded")})},getInfoByOrderForm:function(t){var e=t.clientProfileData.email;$.ajax({type:"GET",url:"/api/dataentities/favoritos/search?_schema=ajp-body&email="+e,dataType:"json",contentType:"application/json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"}}).done(function(e){e.length?(console.log("Usuario com lista"),localStorage.setItem("AJP_listUser",JSON.stringify(e[0])),o.dataUserParsed=e[0],$(document.body).is(".product")&&o.setDataInFrontProduct(),$(document.body).is(".wishlist")&&o.showProductsInFavorites(),o.showProductInShowAlreadyAdd(),$(".shelf-item__wishlist button").removeClass("list-loaded")):(console.log("Primeira vez no wishlist."),o.registerEmailInMDFirstTime(t))})},registerEmailInMDFirstTime:function(e){var t={email:e.clientProfileData.email,userItems:null};$.ajax({type:"POST",url:"/api/dataentities/favoritos/documents?_schema=ajp-body",dataType:"json",contentType:"application/json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(t)}).done(function(e){t.id=e.DocumentId,localStorage.setItem("AJP_listUser",JSON.stringify(t))})},setDataInFrontProduct:function(){var t=!1;o.dataUserParsed.userItems.forEach(function(e){e==skuJson.productId&&(t=!0)}),t&&($(".product-wishlist--button.add").addClass("hide"),$(".product-wishlist--button.remove").removeClass("hide"))},showProductsInFavorites:function(){var t=$(".wishlist-products--wrapper"),a=null;o.dataUserParsed.userItems.forEach(function(e,t,s){a=0==t?"fq=productId:"+e:a+"&fq=productId:"+e});var e="/buscapagina?"+a+"&PS=50&sl=ff2a9142-b3a3-4bb4-94ed-02884096891f&cc=1&sm=0";$.ajax({type:"GET",url:e}).done(function(e){t.append(e),o.removeShelfProductInListUser(),$(".wishlist-products--loader").hide()})},showProductInShowAlreadyAdd:function(){$(".shelf-item__wishlist.shelf-default").each(function(){var e=$(this),t=e.closest(".ajp-shelf").attr("data-product-id");o.dataUserParsed.userItems.find(function(e){return e==t})&&(e.find(".shelf-wishlist--button.shelf.add").addClass("hide"),e.find(".shelf-wishlist--button.shelf.remove").removeClass("hide"))})},addProdutcInList:function(){$(document).one("click",".product-wishlist--button.add",function(e){o.verifyIfUserIsNull();var t=o.dataUserParsed.userItems;null==t?t=[skuJson.productId]:t.push(skuJson.productId);t={id:o.dataUserParsed.id,email:o.dataUserParsed.email,userItems:t};o.sendPatchToMD(t)})},addShelfProductInList:function(){$(document).one("click",".shelf-wishlist--button.shelf.add",function(e){o.verifyIfUserIsNull();var t=$(this).closest(".ajp-shelf").attr("data-product-id"),t=parseInt(t),s=o.dataUserParsed.userItems;null==s?s=[t]:s.push(t);s={id:o.dataUserParsed.id,email:o.dataUserParsed.email,userItems:s};o.sendPatchToMD(s)})},removeProductInList:function(){$(document).one("click",".product-wishlist--button.remove",function(e){var t=o.dataUserParsed.userItems.filter(function(e){return e!==skuJson.productId});t.length||(t=null);t={id:o.dataUserParsed.id,email:o.dataUserParsed.email,userItems:t};o.sendPatchToMD(t)})},removeShelfProductInList:function(){$(document).one("click",".shelf-wishlist--button.shelf.remove",function(e){var t=$(this).closest(".ajp-shelf").attr("data-product-id"),t=parseInt(t),s=o.dataUserParsed.userItems.filter(function(e){return e!==t});s.length||(s=null);s={id:o.dataUserParsed.id,email:o.dataUserParsed.email,userItems:s};o.sendPatchToMD(s)})},removeShelfProductInListUser:function(){$(document).one("click",".shelf-wishlist--button.shelf-button--remove.shelf-user",function(e){var t=$(this).closest(".ajp-shelf").attr("data-product-id"),t=parseInt(t),s=o.dataUserParsed.userItems.filter(function(e){return e!==t});s.length||(s=null);s={id:o.dataUserParsed.id,email:o.dataUserParsed.email,userItems:s};o.sendPatchToMD(s)})},verifyIfUserIsNull:function(){null==o.dataUserParsed&&(vtexid.start(),o.verifyVtexId())},emptyListInUserPage:function(){$(".shelf-item__wishlist button").removeClass("list-loaded"),$(document.body).is(".wishlist")&&($(".wishlist-products--loader").addClass("hide"),$(".wishlist-products--empty").removeClass("hide"))},sendPatchToMD:function(t){var e=o.dataUserParsed.id;$.ajax({type:"PATCH",url:"/api/dataentities/favoritos/documents/"+e+"?_schema=ajp-body",dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"},data:JSON.stringify(t)}).done(function(e){localStorage.setItem("AJP_listUser",JSON.stringify(t)),swal({title:"Lista de desejos atualizada!",icon:"success"}).then(function(){location.reload()})})},reloadClickFunctionsIfCloseModal:function(){$("#dtbot-script").siblings("#vtexIdContainer.ng-scope").find(".vtexIdUI-page.ng-scope.vtexIdUI-confirm-email .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-page-active .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-no-permission .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-multiple-link-account .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-change-pswd .close.vtexIdUI-close").on("click",function(){o.addProdutcInList(),o.removeProductInList(),o.addShelfProductInList(),o.removeShelfProductInList()})},verifyVtexId:function(){var e=setInterval(function(){$("#vtexIdContainer.ng-scope").length&&(clearInterval(e),o.reloadClickFunctionsIfCloseModal())},50)}};$(document).ready(o.init)}catch(e){console.log("Erro na inst√¢ncia do [Wishlist]: ",e)}}();