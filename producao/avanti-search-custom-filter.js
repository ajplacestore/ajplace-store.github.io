/**
 * Avanti Comunicação <contato@penseavanti.com.br>
 * almeidajunior
 * @date Tue Feb 16 2021 13:02:03 GMT-0200 (GMT-02:00)
 */

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function($){window.AvantiSearch={init:function(t,e){var o=this;o.options=$.extend(o.getDefaultOptions(),e),o.options.$result=t,o.options.countProducts=0,o.options.pageCounter=1,o.options.initFilterCookie=!1,o.options.productFilter=!1,o.start(),o.bind()},start:function(){var t=this;if(t.request=t._setRequest(),!1===t.request)return $("body").trigger("avantisearch.emptySearch",[t.options]),!1;t._concatRequest(),t._setPaginationInfo(),t.options.pagination&&t._setPaginationWrap(),t._createButtons(),t.checkAndStart()},_createButtons:function(){var t=this;$(".resultItemsWrapper div[id^=ResultItems]").before('<a class="'+t.options.classLoadLess+" "+t.options.classLoadBtnHide+'">'+t.options.textLoadLess+"</a>").after('<a class="'+t.options.classLoadMore+'">'+t.options.textLoadMore+"</a>")},_setPaginationWrap:function(){var t=$("<div />",{class:this.options.classPagination});this.options.$pager.after(t)},checkAndStart:function(){var t=this;t._checkRequestWithCookie()?t.startWithCookie():t.startWithoutCookie(),t.options.$result.trigger("avantisearch.init",[t.options,t.request])},_checkRequestWithCookie:function(){if("undefined"==typeof Cookies)throw new Error("You need install this plugin https://github.com/js-cookie/js-cookie");var t=parseInt(window.location.hash.substr(1)),e=Cookies.get(this.options.cookieName);if(void 0===e)return!1;var o=JSON.parse(e),e=$.extend({},this.request);return!isNaN(t)&&void 0!==o&&e.path===o.path},startWithCookie:function(){var e=this;e._setParamsFromCookie(),e._applyCookieParams(),e._getTotalItems(function(t){e.options.totalItems=parseInt(t),e.options.$totalItems.text(t),e.options.totalPages=e._getTotalPages(),e._checkAndLoadWithCookie()})},_checkAndLoadWithCookie:function(){var t=this,e=t.request.query.PageNumber,o=t.options.totalPages;if(t.options.$result.trigger("avantisearch.initWithCookie",[t.options,t.request]),t.options.pagination)return t._startPagination(),t.load("html",e,function(){t._showItems(e)}),!1;e===o&&1!==e?(t._showButton(t.options.classLoadLess),t._hideButton(t.options.classLoadMore),t.load("html",e,function(){t._showItems(e),t.load("prepend",e-1)})):1===e?t._startFirst(e,1!==o):1<e&&(t._showButton(t.options.classLoadMore),t._showButton(t.options.classLoadLess),t.load("html",e,function(){t._setUrlHash(e),t._showItems(e),t.load("append",e+1,function(){t.load("prepend",e-1,function(){t.request.query.PageNumber=e,t._concatRequest(),t._saveCookie()})})}))},_startFirst:function(t,e,o){var s=this;void 0===e&&(e=!0),!0===s.options.pagination&&(e=!1),s._hideButton(s.options.classLoadLess),s.load("html",t,function(){s._showItems(t),s._saveCookie(),e?s.load("append",t+1,function(){s._showButton(s.options.classLoadMore),void 0!==o&&o()}):(s._hideButton(s.options.classLoadMore),void 0!==o&&o())})},startWithoutCookie:function(){var t=this;t.options.$result.trigger("avantisearch.initWithoutCookie",[t.options,t.request]),t.options.$result.find("> div > ul > li").attr("page",1).removeClass("last first"),t._setUrlHash(1),t._saveCookie(),t._checkDefaultParams()&&t._setDefaultParams(),t.options.pagination&&t._startPagination(),1===t.options.totalPages?(t._hideButton(t.options.classLoadMore),t._disableButton(t.options.classLoadMore),(t._checkDefaultParams()||t.options.checkHasDefaultParams)&&t._startFirst(1,!0)):t._checkDefaultParams()||t.options.checkHasDefaultParams?t._startFirst(1,!0):t.load("append",2)},_startPagination:function(){var t=this;t._hideButton(t.options.classLoadMore),t._disableButton(t.options.classLoadMore),t._hideButton(t.options.classLoadLess),t._disableButton(t.options.classLoadLess),t._createPagination(),t.bindPagination()},_clearPagination:function(){this.options.$pagination.html("")},_updateQueryStringParameter:function(t,e,o){var s=new RegExp("([?&])"+e+"=.*?(&|$)","i"),a=-1!==t.indexOf("?")?"&":"?";return t.match(s)?t.replace(s,"$1"+e+"="+o+"$2"):t+a+e+"="+o},load:function(t,e,o){var s=this;s.request.query.PageNumber=e,s._concatRequest(),"function"==typeof o?s._search(t,o):s._search(t)},_search:function(s,a,n){var t,i=this,e=i.request.url,o="";i.options.$result.trigger("avantisearch.beforeSearch",[i.options,i.request]),void 0===n&&(n=0),i.options.customSortMax.hasOwnProperty("sortValue")&&(t=parseFloat(i.options.customSortMax.sortValue),i.options.productFilter||i.options.initFilterCookie?(e=e.concat("&","fq=P:","["+t+" TO 999999]"),o=(o=i._updateQueryStringParameter(e,"PageNumber",i.options.pageCounter)).replace("&fq=P:["+t+" TO 999999]","&fq=P:[0 TO "+(t-.01)+"]"),i._searchMinSort(o),i.options.pageCounter=i.options.pageCounter+1):e=e.concat("&","fq=P:","["+t+" TO 999999]")),$.ajax({url:e,type:"GET"}).then(function(t){var e=i.options.$result.find("> div > ul"),o=$(t).find("ul");o.find(".last, .first").removeClass("last first"),o.find(".helperComplement").remove();t=o.find("li");t.attr("page",i.request.query.PageNumber),t.addClass(i.options.classItemPreLoad),i.options.countProducts+=o.find("li").length,i.options.initFilterCookie||1!==i.request.query.PageNumber||0!==i.options.countProducts||(i.options.initFilterCookie=!0,i._search("append")),1!==i.request.query.PageNumber&&0==o.find("li").length&&0<i.options.countProducts&&(i.options.productFilter=!0);o=o.html()||"";e[s](o),i.options.$result.is(":hidden")&&i.options.$result.show(),i.options.$result.trigger("avantisearch.afterSearch",[i.options,i.request]),i.options.countProducts==i.options.$totalItems.text()&&i._hideButton(i.options.classLoadMore),n=0,"function"==typeof a&&a(i)},function(t){throw 500===t.status&&n<i.options.attempts&&(n++,i._search(s,a,n)),new Error("Error on get page",t)})},_searchMinSort:function(t){var o=this;o.options.$result.trigger("avantisearch.beforeSearch",[o.options,o.request]),$.ajax({url:t,type:"GET"}).then(function(t){var e=o.options.$result.find("> div > ul"),t=$(t).find("ul");t.find(".last, .first").removeClass("last first"),t.find(".helperComplement").remove(),t.find("li").attr("page",o.request.query.PageNumber),o.options.countProducts+=t.find("li").length;t=t.html()||"";e.append(t),o.options.$result.is(":hidden")&&o.options.$result.show(),o.options.$result.trigger("avantisearch.afterSearch",[o.options,o.request])},function(t){throw new Error("Error on get page",t)})},_setParamsFromCookie:function(){var t=Cookies.get(this.options.cookieName);this.request=JSON.parse(t)},_applyCookieParams:function(){this._setOrder(),this._setFilters()},_setOrder:function(){this.options.$selectOrder.val(this.request.O)},_setFilters:function(t){for(var e in t=this.request.query.fq){var o=t[e];if("function"==typeof o)return!0;o=this.options.$filters.find('input[rel="fq='+o+'"]');o.length&&o.attr("checked","checked").parent().addClass(this.options.classFilterActive)}},_checkDefaultParams:function(){return!!Object.keys(this.options.defaultParams).length},_setDefaultParams:function(){var t=this;t.request.query.hasOwnProperty("O")&&delete t.options.defaultParams.query.O,t.request=$.extend(!0,t.request,t.options.defaultParams)},_setUrlHash:function(t){t=void 0!==t?t:this.request.query.PageNumber;window.location.hash=t},_showItems:function(t){var e=this;e.options.$result.trigger("avantisearch.beforeShowItems",[e.options,e.request,t]),e.options.$result.find("."+e.options.classItemPreLoad+'[page="'+t+'"]').removeClass(e.options.classItemPreLoad),e.options.$result.trigger("avantisearch.afterShowItems",[e.options,e.request,t])},_enableButton:function(t){$("."+t).removeAttr("disabled")},_disableButton:function(t){$("."+t).attr("disabled","disabled")},_hideButton:function(t){$("."+t).addClass(this.options.classLoadBtnHide)},_showButton:function(t){$("."+t).removeClass(this.options.classLoadBtnHide)},_getPageByType:function _getPageByType(type){var self=this,$items=self.options.$result.find("> div > ul > li"),method="last",operation="+";"prev"===type&&(method="first",operation="-");var page=Number($items[method]().attr("page"));return{showPage:page,nextPage:eval(page+operation+1)}},_concatRequest:function(){var t,e,o=this.request.query,s=this.request.route+"?",a=Object.keys(o).length-1,n=0;for(t in o)s="fq"===t?(e=this._concatRequestFilter(o[t],t),s.concat(e)):s.concat(t,"=",o[t]),n!==a&&(s=s.concat("&")),n++;this.request.url=s},_concatRequestFilter:function(t,e){for(var o="",s=0,a=t.length;s<a;s++)o=o.concat(e,"=",t[s]),s!==a-1&&(o=o.concat("&"));return o},_saveCookie:function(t){void 0===t&&(t=JSON.parse(JSON.stringify(this.request)));t=JSON.stringify(t);Cookies.set(this.options.cookieName,t)},_loadNext:function(t){return!(t.nextPage<1||t.nextPage>this.options.totalPages)},_setPaginationInfo:function(){this.options.totalItems=this._getTotalItems(),this.options.totalPages=this._getTotalPages()},_loadFirst:function(e){var o=this;o._getTotalItems(function(t){o.options.totalItems=parseInt(t),o.options.$totalItems.text(t),o.options.totalPages=o._getTotalPages(),o._startFirst(1,!(o.options.totalPages<2),e)})},_getTotalItems:function(s,a){var e=this;if("function"==typeof s){void 0===a&&(a=0),e._concatRequest();var t="/api/catalog_system/pub/products/search"+e.request.url.replace("/buscapagina","")+"&_from=0&_to=1";return $.ajax({url:t,type:"get"}).then(function(t,e,o){o=o.getResponseHeader("resources"),o=parseInt(o.split("/")[1]);return a=0,s(o)},function(t){throw 500===response.status&&a<e.options.attempts&&(a++,e._getTotalItems(s,a)),new Error("Error on get total items",response)}),!1}t=e.options.$totalItems.text().replace(/\D/g,"");return parseInt(Math.ceil(t))},_getTotalPages:function(){var t=this.request.query.PS,e=this.options.totalItems;return Math.ceil(e/t)},_createPagination:function(){var t=this;t.options.$pagination=$("."+t.options.classPagination),t._createPaginationFirstButton(),t._createPaginationPrevButton(),t._createPaginationButtons(),t._createPaginationNextButton(),t._createPaginationLastButton()},_createPaginationFirstButton:function(){var t=$("<button />",{class:"pagination__button pagination__button--first",page:"1"}).text(this.options.textPaginationFirst);1===this.request.query.PageNumber&&this._disablePaginationButton(t),this.options.$pagination.append(t)},_createPaginationPrevButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--prev",page:t.request.query.PageNumber-1}).text(t.options.textPaginationPrev);1===t.request.query.PageNumber&&t._disablePaginationButton(e),t.options.$pagination.append(e)},_createPaginationButtons:function(){for(var t=this,e=t.request.query.PageNumber-t.options.paginationRangeButtons;e<=t.request.query.PageNumber;e++)e<1||e===t.request.query.PageNumber||(o=$("<button />",{class:"pagination__button pagination__button--page",page:e}).text(e),t.options.$pagination.append(o));var o=$("<button />",{class:"pagination__button pagination__button--page pagination__button--disabled pagination__button--current",page:t.request.query.PageNumber,disabled:"disabled"}).text(t.request.query.PageNumber);t.options.$pagination.append(o);for(e=t.request.query.PageNumber+1;e<=t.request.query.PageNumber+t.options.paginationRangeButtons;e++)e>t._getTotalPages()||(o=$("<button />",{class:"pagination__button pagination__button--page",page:e}).text(e),t.options.$pagination.append(o))},_createPaginationNextButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--next",page:t.request.query.PageNumber+1}).text(t.options.textPaginationNext);t.request.query.PageNumber===t._getTotalPages()&&t._disablePaginationButton(e),t.options.$pagination.append(e)},_createPaginationLastButton:function(){var t=this,e=$("<button />",{class:"pagination__button pagination__button--last",page:t._getTotalPages()}).text(t.options.textPaginationLast);t.request.query.PageNumber===t._getTotalPages()&&t._disablePaginationButton(e),t.options.$pagination.append(e)},_disablePaginationButton:function(t){t.addClass("pagination__button--disabled").attr("disabled","disabled")},_setRequest:function(){var t=this._getRequestUrl();return!1!==t&&this._splitRequestUrl(t)},_getRequestUrl:function(){if(0===this.options.$script.length)return!1;var t=this.options.$script.html(),t=/\/buscapagina\?.+&PageNumber=/gi.exec(t)[0];return decodeURIComponent(t)},_splitRequestUrl:function(t){var s=this,e=t.split("?"),o=e[0];if(1<e.length){var a=window.location.search,n=e[1],i=a.substr(1),e=n.split("#"),a=e[0],n=e[1];s.options.queryObject={},s.options.queryObject.fq=[];e=new RegExp("([^=&]+)=([^&]*)","g");return a.replace(e,function(t,e,o){s._buildQueryStringVTEXParams(t,e,o,s)}),i.replace(e,function(t,e,o){s._checkAndInsertQueryStringBrowserParams(t,e,o,s)}),{route:o,query:s.options.queryObject,hash:n,url:t,path:window.location.pathname+window.location.search}}return{route:o,url:t}},_buildQueryStringVTEXParams:function(t,e,o,s){var a=decodeURIComponent(o),e=decodeURIComponent(e);"fq"===e?s.options.queryObject[e].push(a):s.options.queryObject[e]="PageNumber"===e&&""===o?1:a},_checkAndInsertQueryStringBrowserParams:function(t,e,o,s){o=decodeURIComponent(o),e=decodeURIComponent(e);"O"==e&&(s.options.queryObject[e]=o,s.options.checkHasDefaultParams=!0)},bind:function(){this.bindLoadMoreAndLess(),this.bindOrder(),this.bindFilters()},bindLoadMoreAndLess:function(){var a=this;$("."+a.options.classLoadLess+", ."+a.options.classLoadMore).on("click",function(t){t.preventDefault();var e="next",o="append",s=a.options.classLoadMore;$(this).hasClass(a.options.classLoadLess)&&(e="prev",o="prepend",s=a.options.classLoadLess);t=a._getPageByType(e),e=$.extend({},a.request);e.query.PageNumber=t.showPage,a._saveCookie(e),a._loadNext(t)?a.load(o,t.nextPage):a._hideButton(s),a._setUrlHash(t.showPage),a._showItems(t.showPage)})},bindOrder:function(){var o=this;"O"===o.options.$selectOrder.attr("id")&&o.options.$selectOrder.removeAttr("onchange").unbind("change").off("change"),o.options.$selectOrder.on("change",function(t){t.preventDefault();var e=$(this),t=e.val();o.options.customSortMax.hasOwnProperty("sortValue")&&delete o.options.customSortMax.sortValue,o.options.$result.trigger("avantisearch.beforeChangeOrder",[o.options,o.request,e]),o._setUrlHash(1),o._changeOrder(t,function(){o.options.$result.trigger("avantisearch.afterChangeOrder",[o.options,o.request,e])})})},_changeOrder:function(t,e){this.request.query.O=t,this._concatRequest(),this._setUrlHash(1),this._loadFirst(e)},bindFilters:function(){var a=this;a.options.$filters.find("input").on("change",function(t){var e=$(this),o=e.is(":checked"),s=e.attr("rel"),e=e.parent("label");o?e.addClass(a.options.classFilterActive):e.removeClass(a.options.classFilterActive),a.options.customSortMax.hasOwnProperty("sortValue")&&delete a.options.customSortMax.sortValue,a.options.$result.trigger("avantisearch.beforeFilter",[a.options,a.request,e]),a._refreshFilter(s,o,e)})},_refreshFilter:function(t,o,e){function s(t){var t=(e=t.split("="))[0],e=e[1];o?a.request.query[t].push(e):-1<(e=a.request.query[t].indexOf(e))&&a.request.query[t].splice(e,1)}var a=this;"object"===(void 0===t?"undefined":_typeof(t))?t.map(s):"string"==typeof t&&s(t),a._loadFirst(function(){a.options.$result.trigger("avantisearch.afterFilter",[a.options,a.request,e||null]),a._setUrlHash(1),a.options.pagination&&(a._clearPagination(),a._createPagination()),a.bindPagination()})},bindPagination:function(){var o=this;$("."+o.options.classPagination).find("button").on("click",function(t){t.preventDefault();var t=$(this),e=parseInt(t.attr("page"));o.options.$result.trigger("avantisearch.beforeChangePage",[o.options,o.request]),o.load("html",e,function(){o._setUrlHash(e),o._showItems(e),o.request.query.PageNumber=e,o._clearPagination(),o._startPagination(),o._concatRequest(),o._saveCookie(),o.options.$result.trigger("avantisearch.afterChangePage",[o.options,o.request])})})},getDefaultOptions:function(){return{$resultItemsWrapper:$(".resultItemsWrapper"),$script:$(".resultItemsWrapper").children("script"),$pager:$(".pager"),$totalItems:$(".searchResultsTime:first .resultado-busca-numero .value"),$selectOrder:$("#O"),$filters:$(".search-multiple-navigator label"),classFilterActive:"filter--active",classItemPreLoad:"shelf-item--preload",classLoadBtnHide:"load-btn--hide",classLoadLess:"load-less",classLoadMore:"load-more",classPagination:"pagination",textLoadLess:"Load less",textLoadMore:"Load more",textPaginationFirst:"First",textPaginationPrev:"Prev",textPaginationNext:"Next",textPaginationLast:"Last",textEmptyResult:"No product found",pagination:!1,paginationRangeButtons:3,cookieName:"AvantiSearchQuery",customSortMax:{},defaultParams:{},attempts:1}}},$.fn.avantiSearch=function(t){return AvantiSearch.init(this,t),this}}(jQuery);