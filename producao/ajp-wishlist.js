/**
 * Avanti Comunicação <contato@penseavanti.com.br>
 * almeidajunior
 * @date Thu May 06 2021 11:38:56 GMT-0300 (GMT-03:00)
 */

"use strict";!function(){try{var a={init:function(){a.getInfo(),$(document.body).is(".product")&&(a.addProdutcInList(),a.removeProductInList()),a.addShelfProductInList(),a.removeShelfProductInList()},dataUserOrderForm:null,dataUserParsed:null,getInfo:function(){var e;localStorage&&localStorage.AJP_listUser&&localStorage.AJP_listUser.length?(e=JSON.parse(localStorage.AJP_listUser),null==(a.dataUserParsed=e).userItems?a.emptyListInUserPage():e.userItems.length&&($(document.body).is(".product")&&a.setDataInFrontProduct(),$(document.body).is(".wishlist")&&a.showProductsInFavorites(),a.showProductInShowAlreadyAdd(),$(".shelf-item__wishlist button").removeClass("list-loaded"))):vtexjs.checkout.getOrderForm().done(function(e){e.clientProfileData&&null!=e.clientProfileData.email?a.getInfoByOrderForm(e):$(".shelf-item__wishlist button").removeClass("list-loaded")})},getInfoByOrderForm:function(t){var e=t.clientProfileData.email;$.ajax({type:"GET",url:"/api/dataentities/favoritos/search?_schema=ajp-body&email="+e,dataType:"json",contentType:"application/json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"}}).done(function(e){e.length?(console.log("Usuario com lista"),localStorage.setItem("AJP_listUser",JSON.stringify(e[0])),a.dataUserParsed=e[0],$(document.body).is(".product")&&a.setDataInFrontProduct(),$(document.body).is(".wishlist")&&a.showProductsInFavorites(),a.showProductInShowAlreadyAdd(),$(".shelf-item__wishlist button").removeClass("list-loaded")):(console.log("Primeira vez no wishlist."),a.registerEmailInMDFirstTime(t))})},registerEmailInMDFirstTime:function(e){var t={email:e.clientProfileData.email,userItems:null};$.ajax({type:"POST",url:"/api/dataentities/favoritos/documents?_schema=ajp-body",dataType:"json",contentType:"application/json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(t)}).done(function(e){t.id=e.DocumentId,localStorage.setItem("AJP_listUser",JSON.stringify(t))})},setDataInFrontProduct:function(){var t=!1;a.dataUserParsed.userItems.forEach(function(e){e==skuJson.productId&&(t=!0)}),t&&($(".product-wishlist--button.add").addClass("hide"),$(".product-wishlist--button.remove").removeClass("hide"))},showProductsInFavorites:function(){var t=$(".wishlist-products--wrapper"),o=null;a.dataUserParsed.userItems.forEach(function(e,t,s){o=0==t?"fq=productId:"+e:o+"&fq=productId:"+e});var e="/buscapagina?"+o+"&PS=50&sl=ff2a9142-b3a3-4bb4-94ed-02884096891f&cc=1&sm=0";$.ajax({type:"GET",url:e}).done(function(e){t.append(e),a.removeShelfProductInListUser(),$(".wishlist-products--loader").hide()})},showProductInShowAlreadyAdd:function(){$(".shelf-item__wishlist.shelf-default").each(function(){var e=$(this),t=e.closest(".shelf-item").attr("data-product-id");a.dataUserParsed.userItems.find(function(e){return e==t})&&(e.find(".shelf-wishlist--button.shelf.add").addClass("hide"),e.find(".shelf-wishlist--button.shelf.remove").removeClass("hide"))})},addProdutcInList:function(){$(document).one("click",".product-wishlist--button.add",function(e){a.verifyIfUserIsNull();var t=a.dataUserParsed.userItems;null==t?t=[skuJson.productId]:t.push(skuJson.productId);t={id:a.dataUserParsed.id,email:a.dataUserParsed.email,userItems:t};a.sendPatchToMD(t)})},addShelfProductInList:function(){$(document).one("click",".shelf-wishlist--button.shelf.add",function(e){a.verifyIfUserIsNull();var t=$(this).closest(".shelf-item").attr("data-product-id"),t=parseInt(t),s=a.dataUserParsed.userItems;null==s?s=[t]:s.push(t);s={id:a.dataUserParsed.id,email:a.dataUserParsed.email,userItems:s};a.sendPatchToMD(s)})},removeProductInList:function(){$(document).one("click",".product-wishlist--button.remove",function(e){var t=a.dataUserParsed.userItems.filter(function(e){return e!==skuJson.productId});t.length||(t=null);t={id:a.dataUserParsed.id,email:a.dataUserParsed.email,userItems:t};a.sendPatchToMD(t)})},removeShelfProductInList:function(){$(document).one("click",".shelf-wishlist--button.shelf.remove",function(e){var t=$(this).closest(".shelf-item").attr("data-product-id"),t=parseInt(t),s=a.dataUserParsed.userItems.filter(function(e){return e!==t});s.length||(s=null);s={id:a.dataUserParsed.id,email:a.dataUserParsed.email,userItems:s};a.sendPatchToMD(s)})},removeShelfProductInListUser:function(){$(document).one("click",".shelf-wishlist--button.shelf-button--remove.shelf-user",function(e){var t=$(this).closest(".shelf-item").attr("data-product-id"),t=parseInt(t),s=a.dataUserParsed.userItems.filter(function(e){return e!==t});s.length||(s=null);s={id:a.dataUserParsed.id,email:a.dataUserParsed.email,userItems:s};a.sendPatchToMD(s)})},verifyIfUserIsNull:function(){null==a.dataUserParsed&&(vtexid.start(),a.verifyVtexId())},emptyListInUserPage:function(){$(".shelf-item__wishlist button").removeClass("list-loaded"),$(document.body).is(".wishlist")&&($(".wishlist-products--loader").addClass("hide"),$(".wishlist-products--empty").removeClass("hide"))},sendPatchToMD:function(t){var e=a.dataUserParsed.id;$.ajax({type:"PATCH",url:"/api/dataentities/favoritos/documents/"+e+"?_schema=ajp-body",dataType:"json",contentType:"application/json",headers:{"Content-Type":"application/json",Accept:"application/vnd.vtex.ds.v10+json"},data:JSON.stringify(t)}).done(function(e){localStorage.setItem("AJP_listUser",JSON.stringify(t)),swal({title:"Lista de desejos atualizada!",icon:"success"}).then(function(){location.reload()})})},reloadClickFunctionsIfCloseModal:function(){$("#dtbot-script").siblings("#vtexIdContainer.ng-scope").find(".vtexIdUI-page.ng-scope.vtexIdUI-confirm-email .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-page-active .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-no-permission .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-multiple-link-account .close.vtexIdUI-close, .vtexIdUI-page.ng-scope.vtexIdUI-change-pswd .close.vtexIdUI-close").on("click",function(){a.addProdutcInList(),a.removeProductInList(),a.addShelfProductInList(),a.removeShelfProductInList()})},verifyVtexId:function(){var e=setInterval(function(){$("#vtexIdContainer.ng-scope").length&&(clearInterval(e),a.reloadClickFunctionsIfCloseModal())},50)}};$(document).ready(a.init)}catch(e){console.log("Erro na instância do [Wishlist]: ",e)}}();